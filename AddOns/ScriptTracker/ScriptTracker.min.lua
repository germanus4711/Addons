ScriptTracker=ScriptTracker or{}ScriptTracker.name="ScriptTracker"ScriptTracker.savedVars={}ScriptTracker.selectedChar=nil;ScriptTracker.donate="Donate <3"ScriptTracker.charList={}ScriptTracker.chatButton={}local a=0;local b=1;local c=2;local e={[204549]=true,[204550]=true,[204551]=true,[204552]=true,[204553]=true,[204554]=true,[204555]=true,[204556]=true,[204557]=true,[204558]=true,[204560]=true,[204561]=true,[204562]=true,[204563]=true,[204564]=true,[204565]=true,[204566]=true,[204567]=true,[204568]=true,[204570]=true,[204571]=true,[204572]=true,[204573]=true,[204574]=true,[204575]=true,[204576]=true,[204577]=true,[204578]=true,[204579]=true,[204580]=true,[204581]=true,[204582]=true,[204583]=true,[204584]=true,[204585]=true,[204586]=true,[204587]=true,[204588]=true,[204589]=true,[204590]=true,[204592]=true,[204593]=true,[204594]=true,[204595]=true,[204596]=true,[204597]=true,[204598]=true,[204599]=true,[204600]=true,[204601]=true,[204602]=true,[204603]=true,[204604]=true,[204605]=true,[204606]=true,[204607]=true,[204608]=true,[204609]=true,[204610]=true,[204611]=true,[204612]=true,[204613]=true,[204614]=true,[204615]=true,[204616]=true,[204617]=true,[207949]=true,[207999]=true,[208000]=true,[208001]=true,[208002]=true,[208003]=true,[208004]=true,[208005]=true,[208006]=true,[208007]=true,[208008]=true,[208010]=true,[208011]=true,[208012]=true,[208013]=true,[208014]=true,[208015]=true,[208016]=true,[208017]=true,[208018]=true,[208019]=true,[208020]=true,[208021]=true,[208022]=true,[208023]=true,[208024]=true,[208025]=true,[208026]=true,[208027]=true,[208028]=true,[208029]=true,[208030]=true,[208031]=true,[208032]=true,[208033]=true,[208034]=true,[208035]=true,[208036]=true,[208037]=true,[208038]=true,[208039]=true,[208041]=true,[208042]=true,[208043]=true,[208044]=true,[208045]=true,[208046]=true,[208047]=true,[208048]=true,[208049]=true,[208050]=true,[208051]=true,[208052]=true,[208053]=true,[208054]=true,[208055]=true,[208056]=true,[208057]=true,[208058]=true,[208059]=true,[208060]=true,[208061]=true,[208062]=true,[208063]=true,[208064]=true,[208065]=true,[208066]=true,[208067]=true}local f={[1]={bound=207999,unbound=204549,discoverable=c,image="1.dds"},[2]={bound=208000,unbound=204550,discoverable=a},[3]={bound=208001,unbound=204551,discoverable=a},[4]={bound=208002,unbound=204552,discoverable=a},[5]={bound=208003,unbound=204553,discoverable=b},[6]={bound=208004,unbound=204554,discoverable=a},[7]={bound=208005,unbound=204555,discoverable=a},[8]={bound=208006,unbound=204556,discoverable=a},[9]={bound=208007,unbound=204557,discoverable=a},[10]={bound=208008,unbound=204558,discoverable=a},[12]={bound=208010,unbound=204560,discoverable=a},[13]={bound=208011,unbound=204561,discoverable=a},[14]={bound=208012,unbound=204562,discoverable=a},[15]={bound=208013,unbound=204563,discoverable=a},[16]={bound=208014,unbound=204564,discoverable=c,image="16.dds"},[17]={bound=208015,unbound=204565,discoverable=a},[18]={bound=208016,unbound=204566,discoverable=b},[19]={bound=208017,unbound=204567,discoverable=a},[20]={bound=208018,unbound=204568,discoverable=c,image="20.dds"},[22]={bound=208019,unbound=204570,discoverable=a},[23]={bound=208020,unbound=204571,discoverable=a},[24]={bound=208021,unbound=204572,discoverable=b},[25]={bound=208022,unbound=204573,discoverable=c,image="25.dds"},[26]={bound=208023,unbound=204574,discoverable=a},[27]={bound=208024,unbound=204575,discoverable=a},[28]={bound=208025,unbound=204576,discoverable=a},[29]={bound=208026,unbound=204577,discoverable=a},[30]={bound=208027,unbound=204578,discoverable=a},[31]={bound=208028,unbound=204579,discoverable=a},[32]={bound=208029,unbound=204580,discoverable=b},[33]={bound=208030,unbound=204581,discoverable=a},[34]={bound=208031,unbound=204582,discoverable=c,image="34.dds"},[35]={bound=208032,unbound=204583,discoverable=a},[36]={bound=208033,unbound=204584,discoverable=a},[37]={bound=208034,unbound=204585,discoverable=a},[38]={bound=208035,unbound=204586,discoverable=a},[39]={bound=208036,unbound=204587,discoverable=a},[40]={bound=208037,unbound=204588,discoverable=a},[41]={bound=208038,unbound=204589,discoverable=c,image="41.dds"},[42]={bound=208039,unbound=204590,discoverable=a},[70]={bound=208041,unbound=207949,discoverable=a},[44]={bound=208042,unbound=204592,discoverable=b},[45]={bound=208043,unbound=204593,discoverable=a},[46]={bound=208044,unbound=204594,discoverable=a},[47]={bound=208045,unbound=204595,discoverable=a},[48]={bound=208046,unbound=204596,discoverable=b},[49]={bound=208047,unbound=204597,discoverable=a},[50]={bound=208048,unbound=204598,discoverable=c,image="50.dds"},[51]={bound=208049,unbound=204599,discoverable=a},[52]={bound=208050,unbound=204600,discoverable=a},[53]={bound=208051,unbound=204601,discoverable=a},[54]={bound=208052,unbound=204602,discoverable=a},[55]={bound=208053,unbound=204603,discoverable=a},[56]={bound=208054,unbound=204604,discoverable=a},[57]={bound=208055,unbound=204605,discoverable=a},[58]={bound=208056,unbound=204606,discoverable=a},[59]={bound=208057,unbound=204607,discoverable=c,image="59.dds"},[60]={bound=208058,unbound=204608,discoverable=c,image="60.dds"},[61]={bound=208059,unbound=204609,discoverable=a},[62]={bound=208060,unbound=204610,discoverable=a},[63]={bound=208061,unbound=204611,discoverable=a},[64]={bound=208062,unbound=204612,discoverable=b},[65]={bound=208063,unbound=204613,discoverable=a},[66]={bound=208064,unbound=204614,discoverable=a},[67]={bound=208065,unbound=204615,discoverable=a},[68]={bound=208066,unbound=204616,discoverable=a},[69]={bound=208067,unbound=204617,discoverable=a}}local function g(h)return zo_strformat("$(<<1>>)|$(KB_<<2>>)|<<3>>","MEDIUM_FONT",h,"soft-shadow-thin")end;function ScriptTracker.UpdateUIFontSize()local h=ScriptTracker.savedVars.textsize;local i=g(h)local j=g(h+4)local k=g(h+8)ScriptTrackerUI_Title:SetFont(k)ScriptTrackerUIScribingLabel:SetFont(i)ScriptTrackerUIBodyLabelF:SetFont(j)ScriptTrackerUIBodyLabelS:SetFont(j)ScriptTrackerUIBodyLabelA:SetFont(j)ScriptTrackerUIHideCheckBoxLabel:SetFont(i)ScriptTracker.UpdateList()ScriptTracker.RefreshScriptList(1)ScriptTracker.RefreshScriptList(2)ScriptTracker.RefreshScriptList(3)ScriptTracker.InitComboBox()end;function ScriptTracker.TextureMessage(l)local h=ScriptTracker.savedVars.textsize*2;return"|t"..h..":"..h..":"..l.."|t"end;function ScriptTracker.ColorMessage(m,n)return"|c"..n..m.."|r"end;function ScriptTracker.GetScriptName(o)return zo_strformat(SI_ABILITY_NAME,GetCraftedAbilityScriptDisplayName(o))end;function ScriptTracker.GetScriptDescription(o,p)local m=tostring(ScriptTracker.GetScriptDescriptionType(o))m=m.."\n"..tostring(ScriptTracker.GetScriptDescriptionSource(o))m=m.."\n\n"..tostring(ScriptTracker.GetScriptDescriptionColoredGameDescription(o,p))m=m.."\n\n"..tostring(ScriptTracker.GetScriptCharacterUnlockInfo(o))m=m..tostring(ScriptTracker.GetScriptAvailabilityText(o))if (f[o]or{}).image~=nil then m=m.."\n\n\n\n\n|t320:180:ScriptTracker/"..tostring((f[o]or{}).image).."|t\n\n\n\n"end;if ScriptTracker.savedVars.devmode==false then return m end;m=m.."\n\nID: "..o;return m end;function ScriptTracker.GetScriptDescriptionColoredGameDescription(o,p)local m=tostring(GetCraftedAbilityScriptGeneralDescription(o))if p==false then m=m.."\n\n"..ScriptTracker.ColorMessage(tostring(GetCraftedAbilityScriptAcquireHint(o)),"ffffff")end;return m end;function ScriptTracker.GetScriptDescriptionSource(o)local m=ScriptTracker.ColorMessage("Source: ","ffff00")if (f[o]or{}).discoverable==0 then m=m..ScriptTracker.ColorMessage("Drop","c2c2c2")elseif (f[o]or{}).discoverable==1 then m=m..ScriptTracker.ColorMessage("Quest","d75a3f")elseif (f[o]or{}).discoverable==2 then m=m..ScriptTracker.ColorMessage("Guild","00c7d1")else m=m.."Unknown"end;return m end;function ScriptTracker.GetScriptDescriptionType(o)local m=ScriptTracker.ColorMessage("Type: ","ffff00")if ScriptTracker.GetScriptType(o)==1 then m=m.."Focus"elseif ScriptTracker.GetScriptType(o)==2 then m=m.."Signature"elseif ScriptTracker.GetScriptType(o)==3 then m=m.."Affix"else m=m.."Unknown"end;return m end;function ScriptTracker.Round(self,q)q=math.pow(10,q or 0)self=self*q;if self>=0 then self=math.floor(self+0.5)else self=math.ceil(self-0.5)end;self=self/q;return self end;function ScriptTracker.GetCharacterList()local r={}for s,t in pairs(ScriptTracker.savedVars.charData or{})do if ScriptTracker.savedVars.hiddenChars[s]~=true then local u={[1]=0,[2]=0,[3]=0}local v={[1]=0,[2]=0,[3]=0}for w,x in pairs(t)do if w~="name"then if x.unlocked==true then v[tonumber(x.type)]=v[tonumber(x.type)]+1 end;u[tonumber(x.type)]=u[tonumber(x.type)]+1 end end;local y=u[1]+u[2]+u[3]local z=v[1]+v[2]+v[3]local A=ScriptTracker.Round(z/y*100,1)local B=v[1]==u[1]and v[2]==u[2]and v[3]==u[3]local m=" (F:"..tostring(v[1]).."/"..tostring(u[1]).." - S:"..tostring(v[2]).."/"..tostring(u[2]).." - A:"..tostring(v[3]).."/"..tostring(u[3])..")"table.insert(r,{name=tostring(t.name),id=tostring(s),text=m,complete=B,progress=A})end end;table.sort(r,function(C,D)return C.name<D.name end)ScriptTracker.charList=r;return r end;function ScriptTracker.ToggleCharVisibility(E)for s,t in pairs(ScriptTracker.savedVars.charData or{})do if E==tostring(t.name)then ScriptTracker.savedVars.hiddenChars[s]=(ScriptTracker.savedVars.hiddenChars[s]or false)==false;d(E.." visible: "..tostring(not ScriptTracker.savedVars.hiddenChars[s]))end end;ScriptTracker.InitComboBox()ScriptTracker.GetCharacterList()ScriptTracker.UIResize()end;function ScriptTracker.GetCharsForSettings()local r={}for s,t in pairs(ScriptTracker.savedVars.charData or{})do table.insert(r,tostring(t.name))end;table.sort(r,function(C,D)return C<D end)return r end;function ScriptTracker.GetCharacterData(E)local r=ScriptTracker.GetCharacterList()for F,t in pairs(r)do if t.name==E then return t end end;return nil end;function ScriptTracker.GetScriptCharacterUnlockInfo(o)if#ScriptTracker.charList==0 then ScriptTracker.GetCharacterList()end;local m=""for G,t in ipairs(ScriptTracker.charList)do local p=ScriptTracker.DoesCharHaveScriptUnlocked(t.id,o)if p==true then m=m..ScriptTracker.ColorMessage(t.name,"00ff00")else m=m..ScriptTracker.ColorMessage(t.name,"ff0000")end;if G~=#ScriptTracker.charList then m=m..", "end end;return m end;function ScriptTracker.GetScriptIcon(o)return ScriptTracker.TextureMessage(GetCraftedAbilityScriptIcon(o))end;function ScriptTracker.GetScriptUnlocked(o)return IsCraftedAbilityScriptUnlocked(o)end;function ScriptTracker.GetScriptType(o)return GetCraftedAbilityScriptScribingSlot(o)end;function ScriptTracker.DoesCharHaveScriptUnlocked(H,o)if ScriptTracker.savedVars.charData==nil then return nil end;if ScriptTracker.savedVars.charData[H]==nil then return nil end;for F,t in pairs(ScriptTracker.savedVars.charData[H]or{})do if t.id==o then return t.unlocked end end;return false end;function ScriptTracker.ScanCharacter()local H=GetCurrentCharacterId()ScriptTracker.savedVars.charData[H]={name=GetUnitName("player")}for o=1,70,1 do if ScriptTracker.GetScriptType(o)~=0 then ScriptTracker.savedVars.charData[H][o]={id=o,unlocked=ScriptTracker.GetScriptUnlocked(o),type=ScriptTracker.GetScriptType(o)}end end;if ScriptTracker.selectedChar==H then ScriptTracker.RefreshScriptList(1)ScriptTracker.RefreshScriptList(2)ScriptTracker.RefreshScriptList(3)end;ScriptTracker.InitComboBox()ScriptTracker.ScanInventories()end;function ScriptTracker.OnUIMove()ScriptTracker.savedVars.left=ScriptTrackerUI:GetLeft()ScriptTracker.savedVars.top=ScriptTrackerUI:GetTop()ScriptTracker.savedVars.width=ScriptTrackerUI:GetWidth()ScriptTracker.savedVars.height=ScriptTrackerUI:GetHeight()ScriptTracker.UIResize()end;function ScriptTracker.UIResize()local I=ScriptTrackerUIBody:GetWidth()local J=ScriptTrackerUIBody:GetHeight()-72;ScriptTrackerUIBodyFocusList:SetDimensions(I/3,J)ScriptTrackerUIBodySignatureList:SetDimensions(I/3,J)ScriptTrackerUIBodyAffixList:SetDimensions(I/3,J)ScriptTracker.RefreshScriptList(1)ScriptTracker.RefreshScriptList(2)ScriptTracker.RefreshScriptList(3)end;function ScriptTracker.toDonate()SCENE_MANAGER:Show('mailSend')zo_callLater(function()ZO_MailSendToField:SetText("@akamatsu02")ZO_MailSendSubjectField:SetText(ScriptTracker.name.." - Donation")ZO_MailSendBodyField:SetText("")QueueMoneyAttachment(50000)ZO_MailSendBodyField:TakeFocus()end,200)end;function ScriptTracker.toggleFavorite(K)ScriptTracker.savedVars.fav[tonumber(K.data.id)]=ScriptTracker.savedVars.fav[tonumber(K.data.id)]~=true;ScriptTracker.RefreshScriptList(1)ScriptTracker.RefreshScriptList(2)ScriptTracker.RefreshScriptList(3)end;function ScriptTracker.SetupScriptRow(K,r)K:SetDimensions(K:GetWidth(),ScriptTracker.savedVars.textsize*2+10)K.data=r;K.label=GetControl(K,"Label")K.label:SetDimensions(K.label:GetWidth(),ScriptTracker.savedVars.textsize+2)K.label:SetFont(g(ScriptTracker.savedVars.textsize))if r.unlocked==true then K.label:SetColor(0,1,0,1)else if ScriptTracker.IsScriptAvailable(r.id)==true then K.label:SetColor(1,0.65,0,1)else K.label:SetColor(1,0,0,1)end end;if r.id==0 then K.label:SetText("All scripts unlocked")K:SetHandler("OnMouseEnter",function()ZO_Tooltips_ShowTextTooltip(K,RIGHT,"All scripts unlocked")end)K:SetHandler("OnMouseExit",function()ZO_Tooltips_HideTextTooltip()end)return end;local m=""if r.isfav==true then m=m..ScriptTracker.ColorMessage("[Fav] ","ffff00")end;if r.discoverableType==0 then m=m..ScriptTracker.ColorMessage("[Drop] ","c2c2c2")end;if r.discoverableType==1 then m=m..ScriptTracker.ColorMessage("[Quest] ","d75a3f")end;if r.discoverableType==2 then m=m..ScriptTracker.ColorMessage("[Guild] ","00c7d1")end;m=m..tostring(ScriptTracker.GetScriptIcon(r.id))m=m.." - "m=m..tostring(ScriptTracker.GetScriptName(r.id))K.label:SetText(m)K:SetHandler("OnMouseEnter",function()ZO_Tooltips_ShowTextTooltip(K,RIGHT,ScriptTracker.GetScriptDescription(r.id,r.unlocked))end)K:SetHandler("OnMouseExit",function()ZO_Tooltips_HideTextTooltip()end)end;function ScriptTracker.InitList()local h=ScriptTracker.savedVars.textsize*2+6;ZO_ScrollList_AddDataType(ScriptTrackerUIBodyFocusList,1,"ScriptTrackerUIUnitRow",h,ScriptTracker.SetupScriptRow)ZO_ScrollList_AddDataType(ScriptTrackerUIBodySignatureList,1,"ScriptTrackerUIUnitRow",h,ScriptTracker.SetupScriptRow)ZO_ScrollList_AddDataType(ScriptTrackerUIBodyAffixList,1,"ScriptTrackerUIUnitRow",h,ScriptTracker.SetupScriptRow)end;function ScriptTracker.UpdateList()local h=ScriptTracker.savedVars.textsize*2+6;ZO_ScrollList_UpdateDataTypeHeight(ScriptTrackerUIBodyFocusList,1,h)ZO_ScrollList_UpdateDataTypeHeight(ScriptTrackerUIBodySignatureList,1,h)ZO_ScrollList_UpdateDataTypeHeight(ScriptTrackerUIBodyAffixList,1,h)end;function ScriptTracker.SplitFavorites(L)local M={}local N={}local O={}for F,t in pairs(L)do local P=M;if t.discoverableType==1 then P=N end;if t.discoverableType==2 then P=O end;table.insert(P,t)end;table.sort(N,function(C,D)return C.id<D.id end)table.sort(O,function(C,D)return C.id<D.id end)table.sort(M,function(C,D)return C.id<D.id end)return N,O,M end;function ScriptTracker.SortAndCombineLists(L,N,O,M)table.sort(N,function(C,D)return C.id<D.id end)table.sort(O,function(C,D)return C.id<D.id end)table.sort(M,function(C,D)return C.id<D.id end)local r={}local Q,R,S=ScriptTracker.SplitFavorites(L)for F,t in ipairs(Q)do table.insert(r,t)end;for F,t in ipairs(R)do table.insert(r,t)end;for F,t in ipairs(S)do table.insert(r,t)end;for F,t in ipairs(N)do table.insert(r,t)end;for F,t in ipairs(O)do table.insert(r,t)end;for F,t in ipairs(M)do table.insert(r,t)end;return r end;function ScriptTracker.RefreshScriptList(T)local K=ScriptTrackerUIBodyAffixList;if T==1 then K=ScriptTrackerUIBodyFocusList elseif T==2 then K=ScriptTrackerUIBodySignatureList elseif T==3 then K=ScriptTrackerUIBodyAffixList else return end;local U=ZO_ScrollList_GetDataList(K)ZO_ScrollList_Clear(K)local V={}local W={}local X={}local Y={}local r={}if ScriptTracker.selectedChar~=nil then for F,t in pairs(ScriptTracker.savedVars.charData[ScriptTracker.selectedChar]or{})do local P=W;local Z=(f[tonumber(t.id)]or{}).discoverable;if Z==1 then P=X end;local Z=(f[tonumber(t.id)]or{}).discoverable;if Z==2 then P=Y end;local _=ScriptTracker.savedVars.fav[tonumber(t.id)]==true;if _==true then P=V end;if t.type==T then if ScriptTracker.savedVars.hideUnlocked==true then if t.unlocked==false then table.insert(P,{id=tonumber(t.id),unlocked=t.unlocked==true,type=tonumber(T),isfav=_,discoverableType=Z})end else table.insert(P,{id=tonumber(t.id),unlocked=t.unlocked==true,type=tonumber(T),isfav=_,discoverableType=Z})end end end;r=ScriptTracker.SortAndCombineLists(V,X,Y,W)if#r==0 then table.insert(r,{id=0,unlocked=true,type=0,isfav=false})end;for G=1,#r do U[#U+1]=ZO_ScrollList_CreateDataEntry(1,r[G])end end;ZO_ScrollList_Commit(K)end;function ScriptTracker.OpenWindow(a0)ScriptTrackerUI:SetHidden(not a0)local a1=SCENE_MANAGER:GetCurrentSceneName()if a1=="scribingLibraryKeyboard"or a1=="scribingKeyboard"then ScriptTracker.savedVars.scenes[a1]=a0 end;if a0==true then SetGameCameraUIMode(true)end end;SLASH_COMMANDS["/str"]=function()ScriptTracker.OpenWindow(true)end;SLASH_COMMANDS["/strdev"]=function()ScriptTracker.savedVars.devmode=not ScriptTracker.savedVars.devmode;if ScriptTracker.savedVars.devmode==true then d("Dev-Mode enabled")else d("Dev-Mode disabled")end end;function ScriptTracker.AddInfo(K,o)if IsInGamepadPreferredMode()==true then return end;K:AddVerticalPadding(5)ZO_Tooltip_AddDivider(K)K:AddLine(tostring(ScriptTracker.GetScriptCharacterUnlockInfo(tonumber(o))))if ScriptTracker.savedVars.devmode==false then return end;ZO_Tooltip_AddDivider(K)K:AddLine("ID: "..o)end;function ScriptTracker.AddInfoGamepad(K,o)if IsInGamepadPreferredMode()==false then return end;local a2={['gamepad_inventory_root']=true}local a3=SCENE_MANAGER:GetCurrentSceneName()if not a2[a3]then return end;local a4=K;if not a4 then return end;local a5=a4:GetStyle("bodySection")local a6=a4:GetStyle("bodyDescription")local a7=a4:GetStyle("dividerLine")local a8=a4:AcquireSection(a5)a8:AddTexture(ZO_GAMEPAD_HEADER_DIVIDER_TEXTURE,a7)a8:AddLine(tostring(ScriptTracker.GetScriptCharacterUnlockInfo(tonumber(o))),a6)a4:AddSection(a8)end;function ScriptTracker.InitComboBox()local a9;if ScriptTrackerUIBodyCharDropdown.comboBox~=nil then a9=ScriptTrackerUIBodyCharDropdown.comboBox else a9=ZO_ComboBox_ObjectFromContainer(ScriptTrackerUIBodyCharDropdown)ScriptTrackerUIBodyCharDropdown.comboBox=a9 end;a9:SetFont(g(ScriptTracker.savedVars.textsize))local function aa(F,ab,ac)ScriptTracker.selectedChar=ac.data.id;ScriptTracker.RefreshScriptList(1)ScriptTracker.RefreshScriptList(2)ScriptTracker.RefreshScriptList(3)end;a9:SetSortsItems(false)a9:ClearItems()local ad=ScriptTracker.GetCharacterList()ScriptTracker.selectedChar=ScriptTracker.selectedChar or GetCurrentCharacterId()local ae=nil;for G=1,#ad do local m=ad[G].name..ad[G].text;if ad[G].complete==true then m=ScriptTracker.ColorMessage(m.." - 100%","00FF00")else if ad[G].id==GetCurrentCharacterId()then m=ScriptTracker.ColorMessage("> ","ffff70")..m end;if ad[G].progress<10 then m=m.." - "..ScriptTracker.ColorMessage(tostring(ad[G].progress).."%","ff0000")elseif ad[G].progress<20 then m=m.." - "..ScriptTracker.ColorMessage(tostring(ad[G].progress).."%","ff3300")elseif ad[G].progress<30 then m=m.." - "..ScriptTracker.ColorMessage(tostring(ad[G].progress).."%","ff6600")elseif ad[G].progress<40 then m=m.." - "..ScriptTracker.ColorMessage(tostring(ad[G].progress).."%","ff9900")elseif ad[G].progress<50 then m=m.." - "..ScriptTracker.ColorMessage(tostring(ad[G].progress).."%","ffcc00")elseif ad[G].progress<60 then m=m.." - "..ScriptTracker.ColorMessage(tostring(ad[G].progress).."%","ffff00")elseif ad[G].progress<70 then m=m.." - "..ScriptTracker.ColorMessage(tostring(ad[G].progress).."%","ccff00")elseif ad[G].progress<80 then m=m.." - "..ScriptTracker.ColorMessage(tostring(ad[G].progress).."%","99ff00")elseif ad[G].progress<90 then m=m.." - "..ScriptTracker.ColorMessage(tostring(ad[G].progress).."%","66ff00")else m=m.." - "..ScriptTracker.ColorMessage(tostring(ad[G].progress).."%","33ff00")end end;if ad[G].id==ScriptTracker.selectedChar then ae=G end;entry=a9:CreateItemEntry(m,aa)entry.data=ad[G]a9:AddItem(entry)end;if ae~=nil then a9:SetSelected(ae)end end;local function af(K,E,ag)local ah=K[E]K[E]=function(ai,...)ah(ai,...)local aj=ag(...)if GetItemLinkItemType(aj)==ITEMTYPE_CRAFTED_ABILITY_SCRIPT and ScriptTracker.savedVars.tooltip==true then ScriptTracker.AddInfo(ai,GetItemLinkItemUseReferenceId(aj))end end end;local function ak(K,E,ag)local ah=K[E]K[E]=function(ai,...)ah(ai,...)local aj=ag(...)if GetItemLinkItemType(aj)==ITEMTYPE_CRAFTED_ABILITY_SCRIPT and ScriptTracker.savedVars.tooltip==true then ScriptTracker.AddInfoGamepad(ai,GetItemLinkItemUseReferenceId(aj))end end end;local function al(am,an)if am:GetState()~=SCENE_SHOWN then return end;local a1=am:GetName()ScriptTracker.OpenWindow(ScriptTracker.savedVars.scenes[a1]==true)end;local function ao(ap)local aq={}for s,t in pairs(ap)do if type(t)=="table"then aq[s]=ao(t)else aq[s]=t end end;setmetatable(aq,getmetatable(ap))return aq end;function ScriptTracker.UpdateSavedVars()if ScriptTracker.savedVars.chars==nil then return end;local ar={}for G=1,GetNumCharacters()do local E,F,F,F,F,F,o=GetCharacterInfo(G)E=zo_strformat(SI_ABILITY_NAME,E)if ScriptTracker.savedVars.chars[E]~=nil then ScriptTracker.savedVars.charData[o]=ao(ScriptTracker.savedVars.chars[E])ScriptTracker.savedVars.charData[o].name=E end end;ScriptTracker.savedVars.chars=nil end;function ScriptTracker.LootedItem(F,F,as,F,F,F,at,F,F,o)if at==false then return end;if o==204881 then if IsAchievementComplete(3991)then ScriptTracker.CSA("Looted: "..as)return end;local F,A,au=GetAchievementCriterion(3991,1)ScriptTracker.CSA("Looted: "..as.." ("..A.."/"..au..")")return end;if e[o]==true then ScriptTracker.CSA("Looted: "..as)end end;function ScriptTracker.CSA(m)local av=CENTER_SCREEN_ANNOUNCE:CreateMessageParams(CSA_CATEGORY_LARGE_TEXT)av:SetCSAType(CENTER_SCREEN_ANNOUNCE_TYPE_DISPLAY_ANNOUNCEMENT)av:SetText(m)CENTER_SCREEN_ANNOUNCE:AddMessageWithParams(av)end;function ScriptTracker.LootTracker()if ScriptTracker.savedVars.lootTacker==true then EVENT_MANAGER:RegisterForEvent(ScriptTracker.name.."Loot",EVENT_LOOT_RECEIVED,ScriptTracker.LootedItem)EVENT_MANAGER:AddFilterForEvent(ScriptTracker.name.."Loot",EVENT_LOOT_RECEIVED,REGISTER_FILTER_UNIT_TAG,"player")else EVENT_MANAGER:UnregisterForEvent(ScriptTracker.name.."Loot",EVENT_LOOT_RECEIVED,ScriptTracker.LootedItem)end end;function ScriptTracker.OnItemCollected(F,aw,ax)local ay=GetItemId(aw,ax)if ay~=204881 and e[ay]==nil then return end;ScriptTracker.ScanInventories()ScriptTracker.UpdateCountsView()end;function ScriptTracker.ItemIdToName(o)return zo_strformat(SI_ABILITY_NAME,GetItemLinkName("|H1:item:"..o..":124:1:0:0:0:0:0:0:0:0:0:0:0:1:0:0:1:0:0:0|h|h"))end;function ScriptTracker.IsScriptAvailable(o)local r=f[o]return ScriptTracker.CountItems(r.bound)+ScriptTracker.CountItems(r.unbound)>0 end;function ScriptTracker.GetScriptId(az)for o,t in pairs(f)do if t.bound==az or t.unbound==az then return o end end;return 0 end;function ScriptTracker.GetScriptAvailabilityText(o)local r=f[o]local aA=ScriptTracker.CountItems(r.bound)local aB=ScriptTracker.CountItems(r.unbound)if aA+aB==0 then return""end;local m="\n\nInventory & Bank:\n"if aA>0 then m=m..ScriptTracker.ColorMessage(aA,"00ff00").."x "..ScriptTracker.ColorMessage(ScriptTracker.ItemIdToName(r.bound),"ffff00")end;if aB>0 then if aA>0 then m=m.."\n"end;m=m..ScriptTracker.ColorMessage(aB,"00ff00").."x "..ScriptTracker.ColorMessage(ScriptTracker.ItemIdToName(r.unbound),"ffff00")end;return m end;function ScriptTracker.UpdateCountsView()ScriptTrackerUIScribingLabel:SetText("Open Scribing ("..ScriptTracker.GetInkCount().."|t20:20:/esoui/art/icons/item_grimoire_ink.dds|t)")end;function ScriptTracker.GetInkCount()local aC=GetSlotStackSize(BAG_VIRTUAL,204881)or 0;local aD=0;for F,t in pairs(ScriptTracker.savedVars.inventory.characters)do aD=aD+(t[204881]or 0)end;local aE=ScriptTracker.savedVars.inventory.bank[204881]or 0;return aC+aD+aE end;function ScriptTracker.CountItems(o)local aF=ScriptTracker.savedVars.inventory.bank[o]or 0;local aG=0;for F,t in pairs(ScriptTracker.savedVars.inventory.characters)do aG=aG+(t[o]or 0)end;return aF+aG end;function ScriptTracker.ScanInventories()ScriptTracker.savedVars.inventory.bank={}ScriptTracker.savedVars.inventory.characters[GetCurrentCharacterId()]={}ScriptTracker.Scan(ScriptTracker.savedVars.inventory.bank,BAG_BANK)ScriptTracker.Scan(ScriptTracker.savedVars.inventory.bank,BAG_SUBSCRIBER_BANK)ScriptTracker.Scan(ScriptTracker.savedVars.inventory.characters[GetCurrentCharacterId()],BAG_BACKPACK)end;function ScriptTracker.Scan(aH,aw)for G=0,GetBagSize(aw)do local o=GetItemId(aw,G)if e[o]==true or o==204881 then local h=GetSlotStackSize(aw,G)aH[o]=(aH[o]or 0)+h end end end;local function aI(F,aJ)if aJ~=ScriptTracker.name then return end;ScriptTracker.savedVars=ZO_SavedVars:NewAccountWide("ScriptTracker_Data",1,nil,{chatButton=true,lootTacker=false,tooltip=true,devmode=false,hideUnlocked=false,gamepadtooltip=false,left=nil,top=nil,width=nil,height=nil,charData={},inventory={bank={},characters={}},fav={},scenes={scribingLibraryKeyboard=true,scribingKeyboard=true},hiddenChars={},textsize=20},GetWorldName())local aK=WINDOW_MANAGER:CreateControlFromVirtual("ScriptTrackerUIHideCheckBox",ScriptTrackerUI,"ScriptTrackerUICheckbox")aK:SetDimensions(30,30)aK:SetAnchor(BOTTOMLEFT,ScriptTrackerUI,BOTTOMLEFT,0,0)ZO_CheckButton_SetLabelText(aK,"Hide unlocked scripts")ZO_CheckButton_SetCheckState(aK,ScriptTracker.savedVars.hideUnlocked==true)ZO_CheckButton_SetToggleFunction(aK,function()ScriptTracker.savedVars.hideUnlocked=ZO_CheckButton_IsChecked(aK)==true;ScriptTracker.RefreshScriptList(1)ScriptTracker.RefreshScriptList(2)ScriptTracker.RefreshScriptList(3)end)ScriptTracker.InitList()ScriptTracker.UpdateSavedVars()ScriptTracker.UpdateUIFontSize()ScriptTrackerUI:ClearAnchors()if ScriptTracker.savedVars.left==nil then ScriptTrackerUI:SetAnchor(CENTER,GuiRoot,CENTER,0,0)ScriptTrackerUI:SetDimensions(600,450)ScriptTracker.OnUIMove()else ScriptTrackerUI:SetAnchor(TOPLEFT,GuiRoot,TOPLEFT,ScriptTracker.savedVars.left or 0,ScriptTracker.savedVars.top or 0)ScriptTrackerUI:SetDimensions(ScriptTracker.savedVars.width or 600,ScriptTracker.savedVars.height or 450)end;EVENT_MANAGER:UnregisterForEvent(ScriptTracker.name,EVENT_ADD_ON_LOADED)EVENT_MANAGER:RegisterForEvent(ScriptTracker.name.."Tracker",EVENT_CRAFTED_ABILITY_SCRIPT_LOCK_STATE_CHANGED,ScriptTracker.ScanCharacter)EVENT_MANAGER:RegisterForEvent(ScriptTracker.name.."BagTracker",EVENT_INVENTORY_SINGLE_SLOT_UPDATE,ScriptTracker.OnItemCollected)ScriptTracker.ScanInventories()af(ItemTooltip,"SetAttachedMailItem",GetAttachedItemLink)af(ItemTooltip,"SetBagItem",GetItemLink)af(ItemTooltip,"SetBuybackItem",GetBuybackItemLink)af(ItemTooltip,"SetLootItem",GetLootItemLink)af(ItemTooltip,"SetTradeItem",GetTradeItemLink)af(ItemTooltip,"SetStoreItem",GetStoreItemLink)af(ItemTooltip,"SetTradingHouseListing",GetTradingHouseListingItemLink)af(ItemTooltip,"SetQuestReward",GetQuestRewardItemLink)af(PopupTooltip,"SetLink",function(aL)return aL end)if ScriptTracker.savedVars.gamepadtooltip==true then ak(GAMEPAD_TOOLTIPS:GetTooltip(GAMEPAD_LEFT_TOOLTIP),"LayoutItem",function(aL)return aL end)ak(GAMEPAD_TOOLTIPS:GetTooltip(GAMEPAD_RIGHT_TOOLTIP),"LayoutItem",function(aL)return aL end)ak(GAMEPAD_TOOLTIPS:GetTooltip(GAMEPAD_MOVABLE_TOOLTIP),"LayoutItem",function(aL)return aL end)end;SCENE_MANAGER:RegisterCallback("SceneStateChanged",al)ScriptTracker.UIResize()ZO_CreateStringId("SI_BINDING_NAME_Open","Open ScriptTracker")ScriptTracker.LootTracker()if LibChatMenuButton~=nil then ScriptTracker.chatButton=LibChatMenuButton.addChatButton("ScriptTrackerChatButton",GetCraftedAbilityScriptIcon(1),"Script Tracker",function()ScriptTracker.OpenWindow(ScriptTrackerUI:IsHidden())end)if ScriptTracker.savedVars.chatButton==true then ScriptTracker.chatButton:show()else ScriptTracker.chatButton:hide()end end;ScriptTracker.ScanCharacter()ScriptTracker.UpdateCountsView()ScriptTracker.Settings()end;EVENT_MANAGER:RegisterForEvent(ScriptTracker.name,EVENT_ADD_ON_LOADED,aI)function ScriptTracker.Settings()local aM={type="panel",name=ScriptTracker.name,displayName="Script Tracker",author="akamatsu02",registerForRefresh=true}LibAddonMenu2:RegisterAddonPanel(ScriptTracker.name.." - Options",aM)local aN={}table.insert(aN,{type="checkbox",name="Enable gamepad tooltip (beta) (needs reload)",tooltip="This feature has been tested, but doesn't seem to work for everyone.",getFunc=function()return ScriptTracker.savedVars.gamepadtooltip end,setFunc=function(x)ScriptTracker.savedVars.gamepadtooltip=x end})table.insert(aN,{type="checkbox",name="Track loot",tooltip="Notifies you about looted scripts and ink",getFunc=function()return ScriptTracker.savedVars.lootTacker end,setFunc=function(x)ScriptTracker.savedVars.lootTacker=x;ScriptTracker.LootTracker()end})table.insert(aN,{type="checkbox",name="Show tooltip",tooltip="Show the item tooltip in your inventory",getFunc=function()return ScriptTracker.savedVars.tooltip end,setFunc=function(x)ScriptTracker.savedVars.tooltip=x end})if LibChatMenuButton~=nil then table.insert(aN,{type="checkbox",name="Enable Chat-Button",tooltip="Enable Chat-Button from LibChatMenuButton",getFunc=function()return ScriptTracker.savedVars.chatButton end,setFunc=function(x)ScriptTracker.savedVars.chatButton=x;if ScriptTracker.savedVars.chatButton==true then ScriptTracker.chatButton:show()else ScriptTracker.chatButton:hide()end end})end;table.insert(aN,{type="dropdown",name="Text size",tooltip="Size of the text-labels in the addon",choices={12,14,16,18,20,22,24,26},getFunc=function()return ScriptTracker.savedVars.textsize end,setFunc=function(aO)aO=tonumber(aO)or 20;ScriptTracker.savedVars.textsize=aO;ScriptTracker.UpdateUIFontSize()end})table.insert(aN,{type="divider",height=10,alpha=0.5,width="full"})table.insert(aN,{type="dropdown",name="Show/Hide character",tooltip="Select a character to show/hide it from the list",choices=ScriptTracker.GetCharsForSettings(),getFunc=function()return ScriptTracker.toRemove or""end,setFunc=function(aO)ScriptTracker.toRemove=aO end})table.insert(aN,{type="button",name="Select",tooltip="Select a character to show/hide it from the list",func=function()if ScriptTracker.toRemove==nil then return end;ScriptTracker.ToggleCharVisibility(ScriptTracker.toRemove)ScriptTracker.toRemove=nil end})LibAddonMenu2:RegisterOptionControls(ScriptTracker.name.." - Options",aN)end;d=d